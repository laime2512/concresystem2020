 <form name="formulario" role="form" id="formulario" method="post" action="../lugar/guardar"
		data-fv-excluded="disabled"
		data-fv-icon-valid="glyphicon glyphicon-ok"
	      data-fv-icon-invalid="glyphicon glyphicon-remove"
	      data-fv-icon-validating="glyphicon glyphicon-refresh">                       

<div class="modal fade" id="modalAdicionar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Registrar Nueva ubicacion</h4>
      </div>
      	<div class="modal-body">
	
				  <div class="form-group">
				  	<label>Producto</label>
				  	<select class="form-control" id="codpro" name="codpro">
				  		<option value="">[Seleccionar]</option>
				  		#foreach($p on $productos)
				  		<option value="$p.codpro">$p.xcategoria $p.xtipo $p.nombre</option>
				  		#end
				  	</select>
				  </div>
				  <div class="alert alert-danger" id="mensaje" style="display: none;">
				  <strong>Alerta!</strong> Este producto ya tiene ubicacion.
				</div>
				  <div class="row">
				  	<div class="col-md-6">
				  	<div class="form-group">
							<label>Mueble</label>
							<select id="codmueble" name="codmueble" class="form-control" data-placeholder="Seleccione..." data-fv-notempty="true" >
								<option value="">[Seleccionar]</option>
								#foreach($m in $muebles)
								<option value="$m.codmueble">$m.xtipomueble $m.nombre</option>
								#end
						</select>
						</div>
				  	</div>
				  	<div class="col-md-6">
				  	<div class="form-group">
							<label>Posicion</label>
							<select id="codposicion" name="codposicion" class="form-control" data-placeholder="Seleccione..." data-fv-notempty="true" >
						</select>
						</div>	
				  	</div>
				  </div>
      	</div>
      <div class="modal-footer">
        <button type="submit" id="btnAdicionarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
      </div>
    </div>
  </div>
  
</div>

</form>

<form name="formularioModificar" role="form" id="formularioModificar" method="post" action="../lugar/actualizar"
		data-fv-excluded="disabled"
		data-fv-icon-valid="glyphicon glyphicon-ok"
	      data-fv-icon-invalid="glyphicon glyphicon-remove"
	      data-fv-icon-validating="glyphicon glyphicon-refresh">                       

<div class="modal fade" id="modalModificar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Modificar ubicacion</h4>
      </div>
      	<div class="modal-body">
	
				  <div class="form-group">
				  <input type="hidden" id="codlugar1" name="codlugar" />
				  <input type="hidden" id="cosuc1" name="codsuc" />
				  	<label>Producto</label>
				  	<select class="form-control" id="codpro1" name="codpro" disabled="disabled" >
				  		<option value="">[Seleccionar]</option>
				  		#foreach($p on $productos)
				  		<option value="$p.codpro">$p.xcategoria $p.xtipo $p.nombre ($p.xpresentacion) </option>
				  		#end
				  	</select>
				  	<div class="alert alert-success" id="mensaje" style="display: none;"></div>
				  </div>
				  <div class="row">
				  	<div class="col-md-6">
				  	<div class="form-group">
							<label>Mueble</label>
							<select id="codmueble1" name="codmueble" class="form-control" data-placeholder="Seleccione..." data-fv-notempty="true" >
								<option value="">[Seleccionar]</option>
								#foreach($m in $muebles)
								<option value="$m.codmueble">$m.xtipomueble $m.nombre</option>
								#end
						</select>
						</div>
				  	</div>
				  	<div class="col-md-6">
				  	<div class="form-group">
							<label>Posicion</label>
							<select id="codposicion1" name="codposicion" class="form-control" data-placeholder="Seleccione..." data-fv-notempty="true" >
						</select>
						</div>
				  	</div>
				  </div>
						
								  
      	</div>
      <div class="modal-footer">
        <button type="submit" id="btnAdicionarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
      </div>
    </div>
  </div>
  
</div>

</form>


<div class="modal fade" id="modalEliminar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
<form name="formularioEliminar" role="form" id="formularioEliminar" method="post" action="../lugar/eliminar"
		data-fv-excluded="disabled"
		data-fv-icon-valid="glyphicon glyphicon-ok"
	      data-fv-icon-invalid="glyphicon glyphicon-remove"
	      data-fv-icon-validating="glyphicon glyphicon-refresh">
  <div class="modal-dialog modal-sm" style="width: 40%" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Eliminar Ubicacion del producto</h4>
      </div>
      <div class="modal-body">
   			<input type="hidden" id="codlugar4" name="codlugar" />	
   				<h3>Esta seguro de eliminar esta ubicacion del producto? <b id="lugarLabel"></b></h3>	
	</div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
      </div>
    </div>
  </div>
  </form>
</div>

<div class="row">
	<div class="col-lg-12">
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="dataTable_wrapper">
					<table id="example" class="w3-table w3-striped w3-tiny w3-bordered w3-hoverable w3-card-4">
                        <thead>
                        <tr>
							<th>Nombre del Producto</th>
							<th>Laboratorio</th>
							<th>Tipo</th>
							<th>Presentacion</th>
							<th>Area</th>
							<th>Ubicacion</th>
                        	<th width="200px"></th>
                        </tr>
                        </thead>
                        <tbody>
                        	
                        </tbody>
					</table>  
				</div>
			</div>
		</div>
	</div>
</div> 
                        <script type="text/javascript">
                        $(document).ready(function() {
							var listaMuebles;
                        	$.post('../mueble/listarTodos',function(resp){
								if(resp.status){
									listaMuebles=resp.data;
								}else
									listaMuebles=null;
							});
                        	$('select').chosen({
                        		no_results_text : "No se encuentra:",
                        		width : '100%'
                        	});
                        	$('#codpro').chosen().change(function(){
								var codigo=$('#codpro option:selected');
								if(codigo.val()!=null)
								$.post('../lugar/verificar?codpro='+codigo.val(),function(resp){
									if(resp.data!=null){
										$('#mensaje').html('<strong>Alerta!</strong> Este producto ya tiene ubicacion.<br/>Producto: '+codigo.text()+' Ubicacion: '+resp.data.xtipo_mueble+' '+resp.data.xmueble+' '+resp.data.xposicion);
										$('#mensaje').fadeIn("slow");
										$('#codpro').val('').trigger('chosen:updated');
									}else{
										$('#mensaje').fadeOut("slow");
									}
								});
                            });
							$('#codmueble').chosen().change(function(){
								var xmueble=$('#codmueble option:selected').val();
								for(let i=0;i<listaMuebles.length;i++){
									if(parseInt(listaMuebles[i].codmueble)==parseInt(xmueble)){
										var listaPosiciones=listaMuebles[i].posiciones;
										if(listaPosiciones!=null){
											$('#codposicion').html('');
											$('#codposicion').append('<option>Seleccionar</option>');
											for(let j=0;j<listaPosiciones.length;j++)
												$('#codposicion').append('<option value="'+listaPosiciones[j].codposicion+'">'+listaPosiciones[j].nombre+'</option>');
										}else
											$('#codposicion').append('<option>No existe posiciones</option>');
										$('#codposicion').trigger('chosen:updated');
									}
								}
							});
							$('#codmueble1').chosen().change(function(){
								var xmueble=$('#codmueble1 option:selected').val();
								for(let i=0;i<listaMuebles.length;i++){
									if(parseInt(listaMuebles[i].codmueble)==parseInt(xmueble)){
										var listaPosiciones=listaMuebles[i].posiciones;
										if(listaPosiciones!=null){
											$('#codposicion1').html('');
											$('#codposicion1').append('<option>Seleccionar</option>');
											for(let j=0;j<listaPosiciones.length;j++)
												$('#codposicion1').append('<option value="'+listaPosiciones[j].codposicion+'">'+listaPosiciones[j].nombre+'</option>');
										}else
											$('#codposicion1').append('<option>No existe posiciones</option>');
										$('#codposicion1').trigger('chosen:updated');
									}
								}
							});
                        	
                        	$('#example').DataTable( {
                        		"oLanguage": {
                                    "sUrl": "../../js/Spanish.lang"
                                },
                                "dom":"<'row w3-tiny'<'col-sm-8'<'#tableTitle'>><'col-sm-1'<'#tableHeader.pull-right'>><'col-sm-3'f>><'row'<'col-sm-12'tr>><'row w3-tiny'<'col-sm-5'i><'col-sm-7'p>>",
                      			"processing": true,
                      		    "serverSide": true,
                      		    "ajax": {
                      		    	"type": "POST",
                      	            "url": "../lugar/lista"
                              	},
                      		    "columns": [
                      		                { "data": "xproducto","name": "xproducto" },
                      		                { "data": "xlaboratorio","name": "xlaboratorio" },
											  { "data": "xtipo","name": "xtipo" },
											  { "data": "xpresentacion","name": "xpresentacion" },
											  { "data": "xarea","name": "xarea" },
											  { "data": "xposicion","name": "xposicion"},
                      		            	{ "data": "codpro","name": "codpro" }
                      		    ],
                      		    "createdRow": function ( row, data, index ){
                      		    	$('td',row).eq(0).html(data.xcategoria+' '+data.xtipo+' '+data.xproducto+' '+data.concentracion+' '+data.xmedida);
									$('td',row).eq(5).html(data.xtipo_mueble+' '+data.xmueble+' '+data.xposicion);
									btnGroup='';
                      		    	btnGroup+='<button class="btn btn-xs btn-primary modificar"  data-toggle="tooltip" data-placement="top" title="Modificar" data-id="'+data.codlugar+'"><i class="fa fa-edit"></i> | modificar</button>';
                      		    	btnGroup+='<button class="btn btn-xs btn-danger eliminar"  data-toggle="tooltip" data-placement="top" title="Eliminar" data-id="'+data.codlugar+'"><i class="glyphicon glyphicon-remove-sign"></i> | eliminar</button>';
                      		    	$('td', row).eq(6).html('<div class="btn-group">'+btnGroup+'</div>');
                      	        },
                      	        "drawCallback": function( settings ) {	
                      	        	$('#tableTitle').html('<h6><b>Ubicacion de los productos</b></h6>');
                      	        	$('#tableHeader').html('<button class="btn btn-sm btn-primary" id="btnAdicionar"><i class="fa fa-plus-circle"></i> | adicionar</button>');
                      	        	$('#btnAdicionar').click(function(){
                                		$('#formulario').data('formValidation').resetForm();
        								$('#codmueble').val('').trigger('chosen:updated');
        								$('#codposicion').val('').trigger('chosen:updated');
                                		$('#modalAdicionar').modal('show');
                                	});
                              		$('.modificar').click(function(){ 
                              			$('#formularioModificar').data('formValidation').resetForm();
                                		$('#formularioModificar')[0].reset();
                                  		$.post('../lugar/obtener?codlugar='+$(this).data('id'), function(result) {
                      		            	if(result.status){
                      			    	        $('#modalModificar').modal('show');
                      							$('#formularioModificar').loadJSON(result.data);
												$('#codpro1').val(result.data.codpro).trigger('chosen:updated');
												var xmueble=result.data.codmueble;
												$('#codmueble1').val(xmueble).trigger('chosen:updated');
												for(let i=0;i<listaMuebles.length;i++){
													if(parseInt(listaMuebles[i].codmueble)==parseInt(xmueble)){
														var listaPosiciones=listaMuebles[i].posiciones;
														if(listaPosiciones!=null){
															$('#codposicion1').html('');
															$('#codposicion1').append('<option>Seleccionar</option>');
															for(let j=0;j<listaPosiciones.length;j++)
																$('#codposicion1').append('<option value="'+listaPosiciones[j].codposicion+'">'+listaPosiciones[j].nombre+'</option>');
														}else
															$('#codposicion1').append('<option>No existe posiciones</option>');
														$('#codposicion1').trigger('chosen:updated');
														$('#codposicion1').val(result.data.codposicion).trigger('chosen:updated');
													}
												}
												
												
                      		            	}else{
                      		            		mostrarMensaje('error','No se realizo con exito la Transaccion');
                      		            	}
                      			        }, 'json');
                              		});
                              		$('.eliminar').click(function(){ 
                              			$('#formularioEliminar').data('formValidation').resetForm();
                                		$('#formularioEliminar')[0].reset();
                                  		$.post('../lugar/obtener?codlugar='+$(this).data('id'), function(result) {
                      		            	if(result.status){
                      			    	        $('#modalEliminar').modal('show');
                      							$('#formularioEliminar').loadJSON(result.data);	
                      							$('#lugarLabel').html('Cod: #'+result.data.codlugar);
                      		            	}else{
                      		            		mostrarMensaje('error','No se realizo con exito la Transaccion');
                      		            	}
                      			        }, 'json');
                              		});
                              		$('button[data-toggle="tooltip"]').tooltip({animated: 'fade',placement: 'bottom'});
                              		
                      	        }
                        } );
                        
                        $('.estado').click(function(){
                        	$('#example').dataTable().fnDraw('page');
                        });
                        
                        
                        $('#formulario,#formularioModificar,#formularioEliminar').formValidation(
                  				{locale: 'es_ES'}).on('success.form.fv', function(e) {
                              e.preventDefault();
                              var $form = $(e.target);
                              $.post($form.attr('action'), $form.serialize(), function(result) {
                              	if(result.status){
                      	            $form.data('formValidation').resetForm();
                      	          	$('#formulario')[0].reset();
                      	            //$('#formularioEliminar')[0].reset();
                      	          	
									$('#example').dataTable().fnDraw('page');
                      	        	mostrarMensaje('info','Se realizo con exito la Transaccion');
                      	        }else{
                              		mostrarMensaje('error','No se realizo con exito la Transaccion');
                              	}
                            	$('.modal').modal('hide');
                      	    }, 'json');
                          });

                        
                        });
                        </script>
    