<form name="formulario" role="form" id="formulario" method="post" action="../menu/guardar" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">

    <div class="modal fade" id="modalAdicionar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Adicionar Nuevo Menu</h4>
                </div>
                <div class="modal-body">
                    <!-- Text input-->
                    <div class="form-group">
                        <label>Nombre</label> <input id="nombre" name="nombre" type="text" placeholder="ingrese nombres" class="form-control input-md" data-fv-notempty="true">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnAdicionarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                </div>
            </div>
        </div>

    </div>
    <div class="modal fade" id="modalAdicionarConfirmacion" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Mensaje de Confirmacion</h4>
                </div>
                <div class="modal-body">
                    <label>Esta seguro de adicionar a este menu?</label>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                </div>
            </div>
        </div>

    </div>
</form>
<form name="formularioModificar" role="form" id="formularioModificar" method="post" action="../menu/actualizar" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
    <div class="modal fade" id="modalModificar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Modificar Menu</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="codm1" id="codm" />
                    <!-- Text input-->
                    <div class="form-group">
                        <label>Nombre</label> <input id="nombre1" name="nombre" type="text" placeholder="ingrese nombres" class="form-control input-md" data-fv-notempty="true">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnModificarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                </div>
            </div>
        </div>

    </div>

    <div class="modal fade" id="modalModificarConfirmacion" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Mensaje de Confirmacion</h4>
                </div>
                <div class="modal-body">
                    <label>Esta seguro de modificar a este menu?</label>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                </div>
            </div>
        </div>

    </div>
</form>
<div class="modal fade" id="modalEliminar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <form name="formularioEliminar" role="form" id="formularioEliminar" method="post" action="../menu/eliminar" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
        <div class="modal-dialog " style="width: 40%" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Eliminar Menu</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="codm2" name="codm" />
                    <div class="row">
                        <div class="col-md-9">
                            <h3>Desea eliminar al menu <b id="menuLabel"></b></h3>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="modal fade" id="modalHabilitar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <form name="formularioHabilitar" role="form" id="formularioHabilitar" method="post" action="../menu/habilitar" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
        <div class="modal-dialog " style="width: 40%" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Habilitar Menu</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="codm3" name="codm" />
                    <div class="row">
                        <div class="col-md-9">
                            <h3>Desea habilitar al menu <b id="menu1Label"></b></h3>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="modal fade" id="modalAsignar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <form name="formularioAsignar" role="form" id="formularioAsignar" method="post" action="../menu/asignar" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
        <div class="modal-dialog " style="width: 60%" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Asignar Procesos</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="codm4" name="codm" />
                    <div class="row">
                        <div class="col-md-9">
                            <h3>Menu <b id="menu2Label"></b></h3>
                        </div>
                    </div>
                    <div class="row">
   				<div class="col-md-6">
   					<label>Procesos Disponibles</label>
   				</div>
   				<div class="col-md-6">
   					<label>Procesos Asignados</label>
   				</div>
   			</div>
                    <select id="procesos" name="procesos" multiple="multiple">
   				#foreach($p in $procesos)
   				<option value="$p.codp">$p.nombre</option>
   				#end
   			</select>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="modal fade" id="modalReasignar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <form name="formularioReasignar" role="form" id="formularioReasignar" method="post" action="../menu/reasignar" data-fv-excluded="disabled" data-fv-icon-valid="glyphicon glyphicon-ok" data-fv-icon-invalid="glyphicon glyphicon-remove" data-fv-icon-validating="glyphicon glyphicon-refresh">
        <div class="modal-dialog " style="width: 60%" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Reasignar Procesos</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="codm5" name="codm" />
                    <div class="row">
                        <div class="col-md-9">
                            <h3>Menu <b id="menu3Label"></b></h3>
                        </div>
                    </div>
                    <div class="row">
   				<div class="col-md-6">
   					<label>Procesos Disponibles</label>
   				</div>
   				<div class="col-md-6">
   					<label>Procesos Asignados</label>
   				</div>
   			</div>
                    <select id="procesos2" name="procesos2" multiple="multiple">
   			</select>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
                </div>
            </div>
        </div>
    </form>
</div>
<div class="row">
    <div class="col-lg-3"></div>
    <div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="dataTable_wrapper">
                    <table id="example" class="w3-table-all w3-tiny w3-table-hoverable w3-card-4">
                        <thead>
                            <tr>
                                <th>Nombre del Menu</th>
                                <th width="250px"></th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function() {
        var btnGroup = '';
        var asignar = $('select[name="procesos"]').bootstrapDualListbox();
        var reasignar = $('select[name="procesos2"]').bootstrapDualListbox();
        $('#btnAdicionarConfirmacion').click(function() {
            $('#modalAdicionarConfirmacion').modal('show');
        });
        $('#btnModificarConfirmacion').click(function() {
            $('#modalModificarConfirmacion').modal('show');
        });
        $('#example').DataTable({
            "oLanguage": {
                "sUrl": "../../js/Spanish.lang"
            },
            "processing": true,
            "serverSide": true,
            "dom": "<'row w3-tiny'<'col-sm-4'<'#tableTitle'>><'col-sm-3'<'#tableHeader'>><'col-sm-3'f>><'row'<'col-sm-12'tr>><'row w3-tiny'<'col-sm-5'i><'col-sm-7'p>>",
            "ajax": {
                "type": "POST",
                "url": "../menu/lista",
                "data": function(d) {
                    d.estado = 1;
                }
            },
            "columns": [{
                "data": "nombre"
            }, {
                "data": "codm"
            }],
            "createdRow": function(row, data, index) {
                if (data.estado) {
                    btnGroup = '';
                    btnGroup += '<button class="btn btn-xs btn-primary modificar"  data-toggle="tooltip" data-placement="top" title="Modificar" data-id="' + data.codm + '"><i class="fa fa-edit"></i> | modificar</button>';
                    btnGroup += '<button class="btn btn-xs btn-danger eliminar"  data-toggle="tooltip" data-placement="top" title="Eliminar" data-id="' + data.codm + '"><i class="glyphicon glyphicon-remove-sign"></i> | eliminar</button>';
                    if (data.proceso > 0)
                        btnGroup += '<button class="btn btn-xs btn-success reasignar"  data-toggle="tooltip" data-placement="top" title="Reasignar" data-id="' + data.codm + '"><i class="fa fa-check-square-o"></i> | reasignar</button>';
                    else
                        btnGroup += '<button class="btn btn-xs btn-warning asignar"  data-toggle="tooltip" data-placement="top" title="Asignar" data-id="' + data.codm + '"><i class="glyphicon glyphicon-edit"></i> | asignar</button>';
                    $('td', row).eq(1).html('<div class="btn-group">' + btnGroup + '</div>');
                }
            },
            "drawCallback": function(settings) {
                $('#tableTitle').html('<h6><b>Menus</b></h6>');
                $('#tableHeader').html('<button class="btn btn-sm btn-primary" id="btnAdicionar"><i class="fa fa-plus-circle"></i> | adicionar</button>');
                $('#btnAdicionar').click(function() {
                    $('#formulario').data('formValidation').resetForm();
                    $('#formulario')[0].reset();
                    $('#modalAdicionar').modal('show');
                });
                $('.modificar').click(function() {
                    $('#formularioModificar').data('formValidation').resetForm();
                    $('#formularioModificar')[0].reset();
                    $.post('../menu/obtener?codm=' + $(this).data('id'), function(result) {
                        if (result.status) {
                            $('#modalModificar').modal('show');
                            $('#formularioModificar').loadJSON(result.data);
                        } else {
                            mostrarMensaje('error', 'No se realizo con exito la Transaccion');
                        }
                    }, 'json');
                });
                $('.eliminar').click(function() {
                    $('#formularioEliminar').data('formValidation').resetForm();
                    $('#formularioEliminar')[0].reset();
                    $.post('../menu/obtener?codm=' + $(this).data('id'), function(result) {
                        if (result.status) {
                            $('#modalEliminar').modal('show');
                            $('#formularioEliminar').loadJSON(result.data);
                            $('#menuLabel').html(result.data.nombre);
                        } else {
                            mostrarMensaje('error', 'No se realizo con exito la Transaccion');
                        }
                    }, 'json');
                });
                $('.habilitar').click(function() {
                    $('#formularioHabilitar').data('formValidation').resetForm();
                    $('#formularioHabilitar')[0].reset();
                    $.post('../menu/obtener?codm=' + $(this).data('id'), function(result) {
                        if (result.status) {
                            $('#modalHabilitar').modal('show');
                            $('#formularioHabilitar').loadJSON(result.data);
                            $('#menu1Label').html(result.data.nombre);
                        } else {
                            mostrarMensaje('error', 'No se realizo con exito la Transaccion');
                        }
                    }, 'json');
                });
                $('.asignar').click(function() {
                    $('#formularioAsignar').data('formValidation').resetForm();
                    $('#formularioAsignar')[0].reset();
                    $.post('../menu/obtener?codm=' + $(this).data('id'), function(result) {
                        if (result.status) {
                            $('#modalAsignar').modal('show');
                            $('#formularioAsignar').loadJSON(result.data);
                            $('#menu2Label').html(result.data.nombre);
                            asignar.bootstrapDualListbox('refresh');
                        } else {
                            mostrarMensaje('error', 'No se realizo con exito la Transaccion');
                        }
                    }, 'json');
                });

                $('.reasignar').click(function() {
                    $('#formularioReasignar').data('formValidation').resetForm();
                    $('#formularioReasignar')[0].reset();
                    $.post('../menu/obtener?codm=' + $(this).data('id'), function(result) {
                        if (result.status) {
                            $('#modalReasignar').modal('show');
                            $('#formularioReasignar').loadJSON(result.data);
                            $('#menu3Label').html(result.data.nombre);
                            $('#procesos2').html('');
                            $.each(result.procesos, function(index, valor) {
                                var option = $('<option value="' + valor['codp'] + '"  ' + valor['sel'] + '></option>');
                                $(option).html(valor['nombre'])
                                $(option).appendTo('#procesos2');
                            });
                            reasignar.bootstrapDualListbox('refresh');
                        } else {
                            mostrarMensaje('error', 'No se realizo con exito la Transaccion');
                        }
                    }, 'json');
                });
                $('button[data-toggle="tooltip"]').tooltip({
                    animated: 'fade',
                    placement: 'bottom',
                });

            }
        });

        $('.estado').click(function() {
            $('#example').dataTable().fnDraw('page');
        });

        $('#formulario,#formularioModificar,#formularioEliminar,#formularioHabilitar,#formularioAsignar,#formularioReasignar').formValidation({
            locale: 'es_ES'
        }).on('success.form.fv', function(e) {
            e.preventDefault();
            var $form = $(e.target);
            $.post($form.attr('action'), $form.serialize(), function(result) {
                if (result.status) {
                    $form.data('formValidation').resetForm();
                    $('#formulario')[0].reset();
                    $('#formularioModificar')[0].reset();
                    $('#formularioEliminar')[0].reset();
                    $('#formularioHabilitar')[0].reset();
                    $('#formularioAsignar')[0].reset();
                    $('#formularioReasignar')[0].reset();
                    $('#example').dataTable().fnDraw('page');
                    mostrarMensaje('info', 'Se realizo con exito la Transaccion');
                } else {
                    mostrarMensaje('error', 'No se realizo con exito la Transaccion');
                }
                $('.modal').modal('hide');
            }, 'json');
        });
    });
</script>