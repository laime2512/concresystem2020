<form name="formulario" role="form" id="formulario" method="post" action="../mueble/guardar"
		data-fv-excluded="disabled"
		data-fv-icon-valid="glyphicon glyphicon-ok"
	      data-fv-icon-invalid="glyphicon glyphicon-remove"
	      data-fv-icon-validating="glyphicon glyphicon-refresh">                       

<div class="modal fade" id="modalAdicionar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">

  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Adicionar Nuevo mueble</h4>
      </div>
      	<div class="modal-body">
					<div class="form-group">
						<label>Tipo de mueble</label> 
						<select name="codtimu" id="codtimu" data-fv-notempty="true">
							<option value="">[Seleccionar]</option>
							#foreach($t in $tipos)
							<option value="$t.codtimu">$t.nombre</option>
							#end
						</select>
					</div>
					<div class="form-group">
						<label>Nombre</label> <input id="nombre" name="nombre" type="text"
							placeholder="ingrese nombres" class="form-control input-sm"
							data-fv-notempty="true">
					</div>
					
					
					<div>
						<table class="table" id="tablaPosicion1">
							<thead>
								<tr>
									<th>Nro</th>
									<th>Posicion</th>
									<th>Elimnar</th>
								</tr>
								<tr>
									<td></td>
									<td>
										<button class="btn btn-sm btn-block btn-success" type="button" id="btnAdicionarPosicion">Adicionar posicion</button>
									</td>
									<td></td>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
      <div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
				<button type="submit" id="btnAdicionarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
      </div>
    </div>
  </div>
  
</div>
</form>
<form name="formularioModificar" role="form" id="formularioModificar" method="post" action="../mueble/actualizar"
		data-fv-excluded="disabled"
		data-fv-icon-valid="glyphicon glyphicon-ok"
	      data-fv-icon-invalid="glyphicon glyphicon-remove"
	      data-fv-icon-validating="glyphicon glyphicon-refresh">
<div class="modal fade" id="modalModificar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog"role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Modificar mueble</h4>
      </div>
				<div class="modal-body">
					<input type="hidden" name="codmueble" id="codmueble" />
					<div class="form-group">
						<label>Tipo de mueble</label> 
						<select name="codtimu" id="codtimu1" data-fv-notempty="true">
							<option value="">[Seleccionar]</option>
							#foreach($t in $tipos)
							<option value="$t.codtimu">$t.nombre</option>
							#end
						</select>
					</div>
					<div class="form-group">
						<label>Nombre</label> <input id="nombre" name="nombre" type="text"
							placeholder="ingrese nombres" class="form-control input-sm"
							data-fv-notempty="true">
					</div>
					<div>
						<table class="table" id="tablaPosicion2">
							<thead>
								<tr>
									<th>Nro</th>
									<th>Posicion</th>
									<th>Elimnar</th>
								</tr>
								<tr>
									<td></td>
									<td>
										<button class="btn btn-sm btn-block btn-success" type="button" id="btnAdicionarPosicion2">Adicionar posicion</button>
									</td>
									<td></td>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
					<button type="submit" id="btnModificarConfirmacion" class="btn btn-primary"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar</button>
      </div>
    </div>
  </div>
 
</div>
 </form>
<div class="modal fade" id="modalEliminar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
<form name="formularioEliminar" role="form" id="formularioEliminar" method="post" action="../mueble/eliminar"
		data-fv-excluded="disabled"
		data-fv-icon-valid="glyphicon glyphicon-ok"
	      data-fv-icon-invalid="glyphicon glyphicon-remove"
	      data-fv-icon-validating="glyphicon glyphicon-refresh">
  <div class="modal-dialog " style="width: 40%" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Eliminar mueble</h4>
      </div>
      <div class="modal-body">
   			<input type="hidden" id="codmueble3" name="codmueble" />	
   			<div class="row">
   				<div class="col-md-9"><h3>Desea eliminar a <b id="muebleLabel"></b></h3></div>
   			</div>		
	</div>
      <div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal"><i class="glyphicon glyphicon-remove-sign"></i> Cancelar</button>
				<button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-ok"></i> Aceptar</button>
      </div>
    </div>
  </div>
  </form>
</div>

<div class="row">
	<div class="col-lg-12">
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="dataTable_wrapper">
					<table id="example" class="w3-table-all w3-tiny w3-table-hoverable w3-card-4">
                        <thead>
                        <tr>
							<th>Nombre del mueble</th>
							<th>Tipo de mueble</th>
							<th>Posiciones</th>
                        	<th width="200px"></th>
                        </tr>
                        </thead>
                        <tbody >
                        	
                        </tbody>
					</table>  
				</div>
			</div>
		</div>
	</div>
</div> 
                        <script type="text/javascript">
                        $(document).ready(function() {
                            var btnGroup='';
													$('select').chosen({
                        		no_results_text : "No se encuentra:",
                        		width : '100%'
                        	});
													function enumerarFila(){
														$('.nro').each(function(i){
																$(this).html(i+1);
															});
													}
													function enumerarFila2(){
														$('.nro2').each(function(i){
																$(this).html(i+1);
															});
													}
													$('#btnAdicionarPosicion').click(function(){
														var row=$('<tr></tr>');
														$('<td class="nro"></td>').appendTo(row);
														$('<td><input class="form-control form-control-sm" type="text" name="posiciones" /></td>').appendTo(row);
														$('<td><button type="button" class="btn btn-sm btn-danger btnEliminarPosicion">eliminar</button></td>').appendTo(row);
														$('#tablaPosicion1 > tbody:last').append(row);
														$('.btnEliminarPosicion').click( function(){ 
														var tr = $(this).closest('tr');
															tr.fadeOut(100, function(){
																tr.remove();
																enumerarFila();
																if($('# > tbody>tr').length==0){
																	var row=$('<tr id="unit" align="center"></tr>');
																	$('<td colspan="3">Sin ningun detalle</td>').appendTo(row);
																	$('#tablaPosicion1 > tbody:last').append(row);
																}
														});
													});
														enumerarFila();
													});
                        	
                        	$('#example').DataTable( {
                        		"oLanguage": {
                                    "sUrl": "../../js/Spanish.lang"
                                },
								"dom":"<'row w3-tiny'<'col-sm-8'<'#tableTitle'>><'col-sm-1'<'#tableHeader.pull-right'>><'col-sm-3'f>><'row'<'col-sm-12'tr>><'row w3-tiny'<'col-sm-5'i><'col-sm-7'p>>",
                      			"processing": true,
                      		    "serverSide": true,
                      		    "ajax": {
                      		    	"type": "POST",
                      	            "url": "../mueble/lista",
                      	        	"data": function ( d ) {
                      	                d.estado = 1;
                      	            }
                              	},
                      		    "columns": [
                      		                { "data": "nombre" },
											{ "data": "xtipo_mueble" },
											{ "data": "posiciones" },
                      		            	{ "data": "codmueble" }
                      		    ],
                      		    "createdRow": function ( row, data, index ){
                      		    	if(data.estado){
                          		    	btnGroup='';
                      		    		btnGroup+='<button class="btn btn-xs btn-primary modificar"  data-toggle="tooltip" data-placement="top" title="Modificar" data-id="'+data.codmueble+'"><i class="fa fa-edit"></i> | modificar</button>';
                      		    		btnGroup+='<button class="btn btn-xs btn-danger eliminar"  data-toggle="tooltip" data-placement="top" title="Eliminar" data-id="'+data.codmueble+'"><i class="glyphicon glyphicon-remove-sign"></i> | eliminar</button>';
                      		    		$('td', row).eq(3).html('<div class="btn-group">'+btnGroup+'</div>');
                      		    	}
                      	        },
                      	        "drawCallback": function( settings ) {	
                      	        	$('#tableTitle').html('<h6><b>Gestion Muebles</b></h6>');
                      	        	$('#tableHeader').html('<button class="btn btn-sm btn-primary" id="btnAdicionar"><i class="fa fa-plus-circle"></i> | adicionar</button>');
                      	        	$('#btnAdicionar').click(function(){
                                		$('#formulario').data('formValidation').resetForm();
                                		$('#formulario')[0].reset();
                                		$('#modalAdicionar').modal('show');
        								$('#codtimu').val('').trigger('chosen:updated');
        								$('#tablaPosicion1 > tbody').html('');
                                	});
                              		$('.modificar').click(function(){ 
                              			$('#formularioModificar').data('formValidation').resetForm();
                                		$('#formularioModificar')[0].reset();
																		$('#tablaPosicion2 > tbody').html('');
                                  		$.post('../mueble/obtener?codmueble='+$(this).data('id'), function(result) {
                      		            	if(result.status){
                      			    	        $('#modalModificar').modal('show');
                      										$('#formularioModificar').loadJSON(result.data);
																					$('#codtimu1').val(result.data.codtimu).trigger('chosen:updated');
																					if(result.posiciones!=null){
																						for(i=0;i<result.posiciones.length;i++){
																							var row=$('<tr></tr>');
																							$('<td class="nro2"></td>').appendTo(row);
																							$('<td><input class="form-control form-control-sm" type="text" name="posiciones" value="'+result.posiciones[i].nombre+'" /></td>').appendTo(row);
																							$('<td><button type="button" class="btn btn-sm btn-danger btnEliminarPosicion2">eliminar</button></td>').appendTo(row);
																							$('#tablaPosicion2 > tbody:last').append(row);
																							$('.btnEliminarPosicion2').click( function(){ 
																							var tr = $(this).closest('tr');
																								tr.fadeOut(100, function(){
																									tr.remove();
																									enumerarFila2();
																									if($('#tablaPosicion2 > tbody>tr').length==0){
																										var row=$('<tr id="unit" align="center"></tr>');
																										$('<td colspan="3">Sin ningun detalle</td>').appendTo(row);
																										$('#tablaPosicion2 > tbody:last').append(row);
																									}
																							});
																						});
																						}
																						enumerarFila2();
																					}
                      		            	}else{
                      		            		mostrarMensaje('error','No se realizo con exito la Transaccion');
                      		            	}
                      			        }, 'json');
                              		});
                              		$('.eliminar').click(function(){ 
                              			$('#formularioEliminar').data('formValidation').resetForm();
                                		$('#formularioEliminar')[0].reset();
                                  		$.post('../mueble/obtener?codmueble='+$(this).data('id'), function(result) {
                      		            	if(result.status){
                      			    	        $('#modalEliminar').modal('show');
                      							$('#formularioEliminar').loadJSON(result.data);
                      							$('#muebleLabel').html(result.data.nombre);
                      		            	}else{
                      		            		mostrarMensaje('error','No se realizo con exito la Transacciion');
                      		            	}
                      			        }, 'json');
                              		});
                              		
                              		$('button[data-toggle="tooltip"]').tooltip({animated: 'fade',placement: 'bottom',});
                              		
                      	        }
                        } );
                        
                        
                        $('#formulario,#formularioModificar,#formularioEliminar').formValidation(
                  				{locale: 'es_ES'}).on('success.form.fv', function(e) {
                              e.preventDefault();
                              var $form = $(e.target);
                              $.post($form.attr('action'), $form.serialize(), function(result) {
                              	if(result.status){
                      	            $form.data('formValidation').resetForm();
                      	          	$('#formulario')[0].reset();
                      	        	$('#formularioModificar')[0].reset();
                      	            $('#formularioEliminar')[0].reset();
																		$('#example').dataTable().fnDraw('page');
                      	        	mostrarMensaje('info','Se realizo con exito la Transaccion');
                      	        }else{
                              		mostrarMensaje('error','No se realizo con exito la Transaccin');
                              	}
                            	$('.modal').modal('hide');
                      	    }, 'json');
                          });
                        });
                        </script>
                